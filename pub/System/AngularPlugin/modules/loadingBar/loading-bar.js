(function(){"use strict";angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]);angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]);angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(e){var n=["$q","$cacheFactory","$timeout","$rootScope","$log","cfpLoadingBar",function(n,t,r,a,i,c){var o=0;var l=0;var d=c.latencyThreshold;var s;function u(){r.cancel(s);c.complete();l=0;o=0}function f(n){var r;var a=t.get("$http");var i=e.defaults;if((n.cache||i.cache)&&n.cache!==false&&(n.method==="GET"||n.method==="JSONP")){r=angular.isObject(n.cache)?n.cache:angular.isObject(i.cache)?i.cache:a}var c=r!==undefined?r.get(n.url)!==undefined:false;if(n.cached!==undefined&&c!==n.cached){return n.cached}n.cached=c;return c}return{request:function(e){if(!e.ignoreLoadingBar&&!f(e)){a.$broadcast("cfpLoadingBar:loading",{url:e.url});if(o===0){s=r(function(){c.start()},d)}o++;c.set(l/o)}return e},response:function(e){if(!e||!e.config){i.error("Broken interceptor detected: Config object not supplied in response:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return e}if(!e.config.ignoreLoadingBar&&!f(e.config)){l++;a.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e});if(l>=o){u()}else{c.set(l/o)}}return e},responseError:function(e){if(!e||!e.config){i.error("Broken interceptor detected: Config object not supplied in rejection:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return n.reject(e)}if(!e.config.ignoreLoadingBar&&!f(e.config)){l++;a.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e});if(l>=o){u()}else{c.set(l/o)}}return n.reject(e)}}}];e.interceptors.push(n)}]);angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.autoIncrement=true;this.includeSpinner=true;this.includeBar=true;this.latencyThreshold=100;this.startSize=.02;this.parentSelector="body";this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>';this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>';this.$get=["$injector","$document","$timeout","$rootScope",function(e,n,t,r){var a;var i=this.parentSelector,c=angular.element(this.loadingBarTemplate),o=c.find("div").eq(0),l=angular.element(this.spinnerTemplate);var d,s,u=false,f=0;var h=this.autoIncrement;var g=this.includeSpinner;var p=this.includeBar;var v=this.startSize;function m(){if(!a){a=e.get("$animate")}var o=n.find(i).eq(0);t.cancel(s);if(u){return}r.$broadcast("cfpLoadingBar:started");u=true;if(p){a.enter(c,o,angular.element(o[0].lastChild))}if(g){a.enter(l,o,angular.element(o[0].lastChild))}B(v)}function B(e){if(!u){return}var n=e*100+"%";o.css("width",n);f=e;if(h){t.cancel(d);d=t(function(){$()},250)}}function $(){if(b()>=1){return}var e=0;var n=b();if(n>=0&&n<.25){e=(Math.random()*(5-3+1)+3)/100}else if(n>=.25&&n<.65){e=Math.random()*3/100}else if(n>=.65&&n<.9){e=Math.random()*2/100}else if(n>=.9&&n<.99){e=.005}else{e=0}var t=b()+e;B(t)}function b(){return f}function S(){f=0;u=false}function L(){if(!a){a=e.get("$animate")}r.$broadcast("cfpLoadingBar:completed");B(1);t.cancel(s);s=t(function(){var e=a.leave(c,S);if(e&&e.then){e.then(S)}a.leave(l)},500)}return{start:m,set:B,status:b,inc:$,complete:L,autoIncrement:this.autoIncrement,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})})();
