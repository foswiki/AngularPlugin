(function(){"use strict";angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]);angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]);angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(e){var n=["$q","$cacheFactory","$timeout","$rootScope","$log","cfpLoadingBar",function(n,r,a,t,i,c){var o=0;var l=0;var d=c.latencyThreshold;var s;function u(){a.cancel(s);c.complete();l=0;o=0}function f(n){var a;var t=r.get("$http");var i=e.defaults;if((n.cache||i.cache)&&n.cache!==false&&(n.method==="GET"||n.method==="JSONP")){a=angular.isObject(n.cache)?n.cache:angular.isObject(i.cache)?i.cache:t}var c=a!==undefined?a.get(n.url)!==undefined:false;if(n.cached!==undefined&&c!==n.cached){return n.cached}n.cached=c;return c}return{request:function(e){if(!e.ignoreLoadingBar&&!f(e)){t.$broadcast("cfpLoadingBar:loading",{url:e.url});if(o===0){s=a(function(){c.start()},d)}o++;c.set(l/o)}return e},response:function(e){if(!e||!e.config){i.error("Broken interceptor detected: Config object not supplied in response:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return e}if(!e.config.ignoreLoadingBar&&!f(e.config)){l++;t.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e});if(l>=o){u()}else{c.set(l/o)}}return e},responseError:function(e){if(!e||!e.config){i.error("Broken interceptor detected: Config object not supplied in rejection:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return n.reject(e)}if(!e.config.ignoreLoadingBar&&!f(e.config)){l++;t.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e});if(l>=o){u()}else{c.set(l/o)}}return n.reject(e)}}}];e.interceptors.push(n)}]);angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.includeSpinner=true;this.includeBar=true;this.latencyThreshold=100;this.startSize=.02;this.parentSelector="body";this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>';this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>';this.$get=["$injector","$document","$timeout","$rootScope",function(e,n,r,a){var t;var i=this.parentSelector,c=angular.element(this.loadingBarTemplate),o=c.find("div").eq(0),l=angular.element(this.spinnerTemplate);var d,s,u=false,f=0;var g=this.includeSpinner;var h=this.includeBar;var p=this.startSize;function v(){if(!t){t=e.get("$animate")}var o=n.find(i).eq(0);r.cancel(s);if(u){return}a.$broadcast("cfpLoadingBar:started");u=true;if(h){t.enter(c,o,angular.element(o[0].lastChild))}if(g){t.enter(l,o,angular.element(o[0].lastChild))}m(p)}function m(e){if(!u){return}var n=e*100+"%";o.css("width",n);f=e;r.cancel(d);d=r(function(){B()},250)}function B(){if($()>=1){return}var e=0;var n=$();if(n>=0&&n<.25){e=(Math.random()*(5-3+1)+3)/100}else if(n>=.25&&n<.65){e=Math.random()*3/100}else if(n>=.65&&n<.9){e=Math.random()*2/100}else if(n>=.9&&n<.99){e=.005}else{e=0}var r=$()+e;m(r)}function $(){return f}function b(){f=0;u=false}function S(){if(!t){t=e.get("$animate")}a.$broadcast("cfpLoadingBar:completed");m(1);r.cancel(s);s=r(function(){var e=t.leave(c,b);if(e&&e.then){e.then(b)}t.leave(l)},500)}return{start:v,set:m,status:$,inc:B,complete:S,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})})();