(function(){"use strict";angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]);angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]);angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(e){var a=["$q","$cacheFactory","$timeout","$rootScope","cfpLoadingBar",function(a,n,r,t,i){var c=0;var o=0;var d=i.latencyThreshold;var l;function s(){r.cancel(l);i.complete();o=0;c=0}function f(a){var r;var t=n.get("$http");var i=e.defaults;if((a.cache||i.cache)&&a.cache!==false&&(a.method==="GET"||a.method==="JSONP")){r=angular.isObject(a.cache)?a.cache:angular.isObject(i.cache)?i.cache:t}var c=r!==undefined?r.get(a.url)!==undefined:false;if(a.cached!==undefined&&c!==a.cached){return a.cached}a.cached=c;return c}return{request:function(e){if(!e.ignoreLoadingBar&&!f(e)){t.$broadcast("cfpLoadingBar:loading",{url:e.url});if(c===0){l=r(function(){i.start()},d)}c++;i.set(o/c)}return e},response:function(e){if(!e.config.ignoreLoadingBar&&!f(e.config)){o++;t.$broadcast("cfpLoadingBar:loaded",{url:e.config.url});if(o>=c){s()}else{i.set(o/c)}}return e},responseError:function(e){if(!e.config.ignoreLoadingBar&&!f(e.config)){o++;t.$broadcast("cfpLoadingBar:loaded",{url:e.config.url});if(o>=c){s()}else{i.set(o/c)}}return a.reject(e)}}}];e.interceptors.push(a)}]);angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.includeSpinner=true;this.includeBar=true;this.latencyThreshold=100;this.startSize=.02;this.parentSelector="body";this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>';this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>';this.$get=["$injector","$document","$timeout","$rootScope",function(e,a,n,r){var t;var i=this.parentSelector,c=angular.element(this.loadingBarTemplate),o=c.find("div").eq(0),d=angular.element(this.spinnerTemplate);var l,s,f=false,u=0;var h=this.includeSpinner;var g=this.includeBar;var p=this.startSize;function v(){if(!t){t=e.get("$animate")}var o=a.find(i).eq(0);n.cancel(s);if(f){return}r.$broadcast("cfpLoadingBar:started");f=true;if(g){t.enter(c,o)}if(h){t.enter(d,o)}m(p)}function m(e){if(!f){return}var a=e*100+"%";o.css("width",a);u=e;n.cancel(l);l=n(function(){B()},250)}function B(){if($()>=1){return}var e=0;var a=$();if(a>=0&&a<.25){e=(Math.random()*(5-3+1)+3)/100}else if(a>=.25&&a<.65){e=Math.random()*3/100}else if(a>=.65&&a<.9){e=Math.random()*2/100}else if(a>=.9&&a<.99){e=.005}else{e=0}var n=$()+e;m(n)}function $(){return u}function S(){u=0;f=false}function b(){if(!t){t=e.get("$animate")}r.$broadcast("cfpLoadingBar:completed");m(1);n.cancel(s);s=n(function(){var e=t.leave(c,S);if(e&&e.then){e.then(S)}t.leave(d)},500)}return{start:v,set:m,status:$,inc:B,complete:b,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})})();